---
title: "LST-R-Projection"
author: "Aji John"
date: "8/28/2017"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load the required

```{r}
library(sp)
library(dplyr)
```
## R Markdown

Get the latest imagery, version with Lat/Long

```{r}
#link to the latest satellite imagery
latest <-'SUPER-NATIONAL_1km_SFC-T_20170829_1600.gini.nc4'

```

## Including Plots

Open the gini as netCDF

```{r, echo=FALSE}
#read the GINI as netCDF file
# load the ncdf4 package
library(ncdf4)
# open a netCDF file
ncin <- nc_open(latest)
print(ncin)
```

get the surface temperature variable

```{r, echo=FALSE}

sfct <- ncvar_get(ncin, "SFC_T")
dim(sfct)

```

sfct is a two dimenional array

```{r, echo=FALSE}

x <- ncvar_get(ncin,"x")
nx <- dim(x)
head(nx)
summary(x)
```

```{r, echo=FALSE}
# get proj y
y <- ncvar_get(ncin,"y")
ny <- dim(y)
head(ny)
summary(y)
```

Time is only for onetimestamp
```{r, echo=FALSE}
print(c(nx,ny))
# get time
time <- ncvar_get(ncin,"time")
time

tunits <- ncatt_get(ncin,"time","units")
nt <- dim(time)
as.character(ncin$dim$time$vals)
```

Assuming that this timestamp is in milliseconds:
GMT: Friday, August 25, 2017 7:00:00 PM


Get lat long
```{r, echo=FALSE}

lat <- ncvar_get(ncin,"lat")
nlat <- dim(lat)
lat_df <- data.frame(lat = as.vector(lat))
lat_df
```

```{r, echo=FALSE}
# get long
long <- ncvar_get(ncin,"lon")
long_df <- data.frame(lon = as.vector(long))
long_df
```

Our goal is to create spatial points dataframe

latitude is represented by horizontal lines, which go up and down (North and South) the Y axis, and Longitude is X
```{r, echo=FALSE}
# get proj y
xy_df <- data.frame(lon=long_df$lon,lat=lat_df$lat)

coordinates(xy_df)= ~lon + lat
sfct_df <- data.frame(sfct = as.vector(sfct))
lst_sp_fw <- SpatialPointsDataFrame(coordinates(xy_df), data =sfct_df
                                    , proj4string = CRS("+proj=longlat +ellps=WGS84"))
```

Now, we created the spatial points dataframe and existing points are
Sterographic , and the units are in km

next, we transform it to lat/long

```{r, echo=FALSE}
#lst_sp_fw_proj <- spTransform(lst_sp_fw, CRS("+proj=longlat +ellps=WGS84"))
```


Verify the bounding box
```{r, echo=FALSE}
summary(lst_sp_fw)
bbox(lst_sp_fw)
```

Lets try to plot it

```{r, echo=FALSE}
library(ggmap)
bgMap = get_map(as.vector(bbox(lst_sp_fw)), source = "google", zoom = 1)
```

```{r, echo=FALSE}
plot(bgMap) 
coordinates_df <- as.data.frame(lst_sp_fw@coords)
points(coordinates_df$lon, coordinates_df$lat, col = "red", cex = .6)
```

Map is focusing on South America, means, transform didn't work
```{r, echo=FALSE}
# commemt

us_map<-get_map(location='united states', zoom=3, maptype = "terrain",
             source='google',color='color')
```
```{r, echo=FALSE}
# commemt
lst_df_final <- as.data.frame(lst_sp_fw)
ggmap(us_map) + geom_point(
        aes(x=lon, y=lat,  colour=sfct), 
        data=lst_df_final, alpha=.5, na.rm = T)  + 
        scale_color_gradient(low="beige", high="blue")
```
